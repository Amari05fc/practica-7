{{ define "index.html"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.title}}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        h1 {
            background-color: #4CAF50;
            color: white;
            padding: 1em;
            text-align: center;
        }
        nav {
            background-color: #333;
            overflow: hidden;
        }
        nav ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
        }
        nav ul li {
            float: left;
        }
        nav ul li {
            display: block;
            color: white;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
        }
        nav ul li {
            background-color: #111;
        }
        main {
            padding: 1em;
        }
        section {
            margin-bottom: 2em;
        }
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 1em;
            position: fixed;
            width: 100%;
            bottom: 0;
        }
    </style>
</head>
<body >
    <nav>
        <H1>Hola mundo</H1>
    </nav>

    <main>
        <p>Desde servidor en GO</p>
        <h3>Usuarios</h3>
        <p>Total de usuarios registrados <strong>{{.total_users }}</strong></p>
        <form id="user-form">
            <label for="email">
                Email:
                <input type="email" name="email" required>
            </label>
            <label for="nombre">
                Nombre: 
                <input type="text" name="name" required>
            </label>
            <button type="submit">Guardar</button>
        </form>
        <ul id="user-list">
            {{range .user}}
            <li>{{.Name}} - {{ .Email }}</li>
            {{end}}
        </ul>
    </main>


    <script>
        const userList = document.getElementById("user-list")
        const userForm = document.getElementById("user-form")
        async function saveUser(event) {
        event.preventDefault()
        const formData = new FormData(userForm)
        const response = await fetch('/api/users', {
            method: 'POST',
            headers: {
            "Content-Type": "application/json"
            },
            body: JSON.stringify(Object.fromEntries(formData))
        })
        await getUsers()
        }
    
        async function getUsers() {
        const response = await fetch(
            '/api/users',
            {
            method: 'GET'
            }
        )
        const users = await response.json()
        userList.innerHTML = ''
        for (const user of users) {
            const li = document.createElement('li')
            const btn = document.createElement('button')
            btn.textContent = 'Eliminar'
            btn.addEventListener('click', () => deleteUser(user.Id))
            li.appendChild(document.createTextNode(`${user.Name} - ${user.Email}`))
            li.appendChild(btn)
            userList.appendChild(li)
        }
        }
    
        async function deleteUser(id) {
        const response = await fetch(`/api/users/${id}`, {
            method: 'DELETE'
        })
        await getUsers()
        }
    
        getUsers()
        userForm.addEventListener("submit", saveUser)
    </script>

    
</body>
</html>
{{end}}